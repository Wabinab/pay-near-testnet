"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6847],{76847:(at,v,o)=>{o.r(v),o.d(v,{Tab3PageModule:()=>nt});var l=o(11929),u=o(96814),_=o(60095),L=o(23554),p=o(15861),e=o(85678),y=o(78645),z=o(84552);class T extends y.x{constructor(s=1/0,a=1/0,t=z.l){super(),this._bufferSize=s,this._windowTime=a,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=a===1/0,this._bufferSize=Math.max(1,s),this._windowTime=Math.max(1,a)}next(s){const{isStopped:a,_buffer:t,_infiniteTimeWindow:n,_timestampProvider:r,_windowTime:c}=this;a||(t.push(s),!n&&t.push(r.now()+c)),this._trimBuffer(),super.next(s)}_subscribe(s){this._throwIfClosed(),this._trimBuffer();const a=this._innerSubscribe(s),{_infiniteTimeWindow:t,_buffer:n}=this,r=n.slice();for(let c=0;c<r.length&&!s.closed;c+=t?1:2)s.next(r[c]);return this._checkFinalizedStatuses(s),a}_trimBuffer(){const{_bufferSize:s,_timestampProvider:a,_buffer:t,_infiniteTimeWindow:n}=this,r=(n?1:2)*s;if(s<1/0&&r<t.length&&t.splice(0,t.length-r),!n){const c=a.now();let d=0;for(let h=1;h<t.length&&t[h]<=c;h+=2)d=h;d&&t.splice(0,d+1)}}}var E=o(47394),b=o(22832),M=o(65592),O=o(79360),w=o(8251),F=o(54829),A=o(74825);var Z=o(94664);class G{constructor(){this.subject=new T(1),this.subscriptions=new E.w0}doFilter(s){this.subject.next(s)}dispose(){this.subscriptions.unsubscribe()}notEmpty(s,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[s]){const n=t[s].currentValue;null!=n&&a(n)}}))}has(s,a){this.subscriptions.add(this.subject.subscribe(t=>{t[s]&&a(t[s].currentValue)}))}notFirst(s,a){this.subscriptions.add(this.subject.subscribe(t=>{t[s]&&!t[s].isFirstChange()&&a(t[s].currentValue)}))}notFirstAndEmpty(s,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[s]&&!t[s].isFirstChange()){const n=t[s].currentValue;null!=n&&a(n)}}))}}const f=new e.OlP("NGX_ECHARTS_CONFIG");let D=(()=>{var i;class s{constructor(t,n,r){this.el=n,this.ngZone=r,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new e.vpe,this.optionsError=new e.vpe,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new T(1),this.resize$=new y.x,this.changeFilter=new G,this.echarts=t.echarts}ngOnChanges(t){this.changeFilter.doFilter(t)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(function R(i,s=b.z,a){const t=(0,A.H)(i,s);return function P(i,s){return(0,O.e)((a,t)=>{const{leading:n=!0,trailing:r=!1}=null!=s?s:{};let c=!1,d=null,h=null,m=!1;const it=()=>{null==h||h.unsubscribe(),h=null,r&&(S(),m&&t.complete())},st=()=>{h=null,m&&t.complete()},C=g=>h=(0,F.Xf)(i(g)).subscribe((0,w.x)(t,it,st)),S=()=>{if(c){c=!1;const g=d;d=null,t.next(g),!m&&C(g)}};a.subscribe((0,w.x)(t,g=>{c=!0,d=g,(!h||h.closed)&&(n?S():C(g))},()=>{m=!0,(!(r&&c&&h)||h.closed)&&t.complete()}))})}(()=>t,a)}(100,b.z,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(()=>{this.animationFrameID=window.requestAnimationFrame(()=>this.resize$.next())})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",t=>this.onOptionsChange(t)),this.changeFilter.notFirstAndEmpty("merge",t=>this.setOption(t)),this.changeFilter.has("loading",t=>this.toggleLoading(!!t)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(t){this.chart?t?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(n=>t?n.showLoading(this.loadingType,this.loadingOpts):n.hideLoading())}setOption(t,n){if(this.chart)try{this.chart.setOption(t,n)}catch(r){console.error(r),this.optionsError.emit(r)}}refreshChart(){var t=this;return(0,p.Z)(function*(){t.dispose(),yield t.initChart()})()}createChart(){const t=this.el.nativeElement;if(window&&window.getComputedStyle){const n=window.getComputedStyle(t,null).getPropertyValue("height");(!n||"0px"===n)&&(!t.style.height||"0px"===t.style.height)&&(t.style.height="400px")}return this.ngZone.runOutsideAngular(()=>("function"==typeof this.echarts?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:r})=>r(t,this.theme,this.initOpts)))}initChart(){var t=this;return(0,p.Z)(function*(){yield t.onOptionsChange(t.options),t.merge&&t.chart&&t.setOption(t.merge)})()}onOptionsChange(t){var n=this;return(0,p.Z)(function*(){t&&(n.chart||(n.chart=yield n.createChart(),n.chart$.next(n.chart),n.chartInit.emit(n.chart)),n.setOption(n.options,!0))})()}createLazyEvent(t){return this.chartInit.pipe((0,Z.w)(n=>new M.y(r=>(n.on(t,c=>this.ngZone.run(()=>r.next(c))),()=>{this.chart&&(this.chart.isDisposed()||n.off(t))}))))}}return(i=s).\u0275fac=function(t){return new(t||i)(e.Y36(f),e.Y36(e.SBq),e.Y36(e.R0b))},i.\u0275dir=e.lG2({type:i,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[e.TTD]}),s})();const I=i=>({provide:f,useValue:i});let N=(()=>{var i;class s{static forRoot(t){return{ngModule:s,providers:[I(t)]}}static forChild(){return{ngModule:s}}}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),s})();var x=o(96116),J=o(66588),$=o(63891),B=o(28615);const Q=["swiper"];function U(i,s){1&i&&(e.ynx(0),e.TgZ(1,"div",5)(2,"p",6),e._uU(3,"Please login to continue"),e.qZA()(),e.BQk())}function Y(i,s){if(1&i){const a=e.EpF();e.TgZ(0,"div",5)(1,"p",6),e._uU(2,"Stats not activated."),e.qZA(),e.TgZ(3,"ion-button",8),e.NdJ("click",function(){e.CHM(a);const n=e.oxw(2);return e.KtG(n.activate_stats())}),e._uU(4,"Activate"),e.qZA()()}}function V(i,s){if(1&i){const a=e.EpF();e.TgZ(0,"ion-segment-button",14),e.NdJ("click",function(){const r=e.CHM(a).index,c=e.oxw(3);return e.KtG(c._segment_sel(r))}),e.TgZ(1,"ion-label"),e._uU(2),e.ALo(3,"titlecase"),e.qZA()()}if(2&i){const a=s.$implicit;e.Q6J("value",a),e.xp6(2),e.Oqu(e.lcZ(3,2,a))}}function H(i,s){if(1&i){const a=e.EpF();e.TgZ(0,"ion-refresher",17),e.NdJ("ionRefresh",function(n){e.CHM(a);const r=e.oxw(4);return e.KtG(r.handle_refresh(n))}),e._UZ(1,"ion-refresher-content"),e.qZA()}}const j=i=>({$implicit:i});function W(i,s){if(1&i&&(e.TgZ(0,"swiper-slide")(1,"ion-card",15)(2,"ion-card-content"),e.YNc(3,H,2,0,"ng-template",16),e.qZA()()()),2&i){const a=s.$implicit;e.oxw(3);const t=e.MAs(8);e.xp6(3),e.Q6J("ngTemplateOutlet",t)("ngTemplateOutletContext",e.VKq(2,j,a))}}function K(i,s){if(1&i){const a=e.EpF();e.ynx(0),e.TgZ(1,"ion-segment",9),e.NdJ("ngModelChange",function(n){e.CHM(a);const r=e.oxw(2);return e.KtG(r.curr_seg=n)}),e.YNc(2,V,4,4,"ion-segment-button",10),e.qZA(),e.TgZ(3,"swiper-container",11,12),e.NdJ("swiperafterinit",function(){e.CHM(a);const n=e.oxw(2);return e.KtG(n.swiper_ready())})("swiperslidechange",function(n){e.CHM(a);const r=e.oxw(2);return e.KtG(r.swiper_slided(n))}),e.YNc(5,W,4,4,"swiper-slide",13),e.qZA(),e.BQk()}if(2&i){const a=e.oxw(2);e.xp6(1),e.Q6J("ngModel",a.curr_seg),e.xp6(1),e.Q6J("ngForOf",a.segments),e.xp6(3),e.Q6J("ngForOf",a.segments)}}function X(i,s){if(1&i&&(e.ynx(0),e.YNc(1,Y,5,0,"div",7)(2,K,6,3,"ng-container",3),e.BQk()),2&i){const a=e.oxw();e.xp6(1),e.Q6J("ngIf",!a.stats_activated),e.xp6(1),e.Q6J("ngIf",a.stats_activated)}}function k(i,s){1&i&&(e.TgZ(0,"p",20),e._uU(1," Charts not loaded. Pull down to refresh. "),e.qZA())}function q(i,s){if(1&i&&(e.YNc(0,k,2,0,"p",18),e._UZ(1,"div",19)(2,"div",19)),2&i){const a=e.oxw();e.Q6J("ngIf",!a.month_option),e.xp6(1),e.Q6J("options",a.month_option),e.xp6(1),e.Q6J("options",a.year_option)}}const tt=[{path:"",component:(()=>{var i;class s{constructor(t,n,r){this.walletSvc=t,this.titlePipe=n,this.miscSvc=r,this.stats_activated=!0,this.year_unit="",this.segments=["spendings","earnings"],this.curr_seg=this.segments[0],this.test_x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.test_y=[1.5,3,4.5,2.8,10.7,12.3,6.2,8.5,1.2,.6,12.3,5.7]}ngOnInit(){this.month_unit="",setTimeout(()=>this.refresh_actions(),1e3)}handle_refresh(t){var n=this;return(0,p.Z)(function*(){yield n.refresh_actions(),t.target.complete()})()}refresh_actions(){var t=this;return(0,p.Z)(function*(){t.stats_activated=yield t.walletSvc.view("stats_activated",{account:t.account_id}),t.stats_activated&&(t.spend_stats=yield t.walletSvc.view("get_spendings",{account:t.account_id}),t.earn_stats=yield t.walletSvc.view("get_earnings",{account:t.account_id}),t.draw_charts())})()}get account_id(){var t;return null!==(t=this.walletSvc.account_id)&&void 0!==t?t:""}activate_stats(){var t;this.walletSvc.call("activate_statistics",{},null!==(t=J.utils.format.parseNearAmount("0.75"))&&void 0!==t?t:"0")}swiper_ready(){var t;this.swiper=null===(t=this.swiperRef)||void 0===t?void 0:t.nativeElement.swiper}swiper_slided(t){this.curr_seg=this.segments[t.target.swiper.activeIndex],this.draw_charts()}_segment_sel(t){var n,r;(!this.swiper||null!==(n=this.swiper)&&void 0!==n&&n.destroyed)&&this.swiper_ready(),null===(r=this.swiper)||void 0===r||r.slideTo(t,500)}draw_charts(){this.curr_seg==this.segments[0]&&this._internal_draw_chart(this.spend_stats),this.curr_seg==this.segments[1]&&this._internal_draw_chart(this.earn_stats)}_internal_draw_chart(t){const n=this._convert_values(t.values_months,"month");this.month_option={title:{text:this.titlePipe.transform(`${this.curr_seg} by months in `)+`${this.month_unit}N`,textAlign:"center",left:"50%"},tooltip:{},xAxis:{name:"Month Year",data:this._monthbin_alterer(t.bins_months),nameLocation:"middle",nameTextStyle:{padding:[10,0,0,0]}},yAxis:{name:`Total ${this._paid_earn(this.curr_seg)} (${this.month_unit}N)`,nameTextStyle:{padding:[0,0,0,50]}},series:[{name:this.curr_seg,type:"bar",label:{show:!0,position:"top",rotate:90,align:"left",verticalAlign:"middle"},data:n}]};const r=this._convert_values(t.values_years,"year");this.year_option={title:{text:this.titlePipe.transform(`${this.curr_seg} by years in `)+`${this.year_unit}N`,textAlign:"center",left:"50%"},tooltip:{},xAxis:{name:"Year",data:t.bins_years,nameLocation:"middle",nameTextStyle:{padding:[10,0,0,0]}},yAxis:{name:`Total ${this._paid_earn(this.curr_seg)} (${this.year_unit}N)`,nameTextStyle:{padding:[0,0,0,50]}},series:[{name:this.curr_seg,type:"bar",label:{show:!0,position:"top",rotate:90,align:"left",verticalAlign:"middle"},color:"#b35fbe",data:r}]}}_monthbin_alterer(t){return t.map(n=>{let r=n.split(" ");return`${r[1].padStart(2,"0")}/${r[0]}`})}_paid_earn(t){return t==this.segments[0]?"Paid":"Earn"}_convert_values(t,n){const r=this._find_median(t.map(c=>parseFloat(c)));return r>1e9?(this._set_units(n,"B"),t.map(c=>Math.round(parseFloat(c)/1e9))):r>1e6?(this._set_units(n,"M"),t.map(c=>Math.round(parseFloat(c)/1e6))):r>1e3?(this._set_units(n,"k"),t.map(c=>Math.round(parseFloat(c)/1e3))):(this._set_units(n,""),t)}_set_units(t,n){"month"==t?this.month_unit=n:this.year_unit=n}_find_median(t){const n=Math.floor(t.length/2),r=[...t].sort((c,d)=>c-d);return t.length%2!=0?r[n]:(r[n-1]+r[n])/2}}return(i=s).\u0275fac=function(t){return new(t||i)(e.Y36($.g),e.Y36(u.rS),e.Y36(B.Y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-tab3"]],viewQuery:function(t,n){if(1&t&&e.Gf(Q,5),2&t){let r;e.iGM(r=e.CRH())&&(n.swiperRef=r.first)}},decls:9,vars:3,consts:[[1,"ion-no-border"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["graphTemplate",""],[1,"container-center"],[1,"display-6"],["class","container-center",4,"ngIf"],["size","large",3,"click"],["value","spendings",3,"ngModel","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],[3,"swiperafterinit","swiperslidechange"],["swiper",""],[4,"ngFor","ngForOf"],[3,"value","click"],[1,"no-border"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ionRefresh"],["class","text-danger text-center",4,"ngIf"],["echarts","",3,"options"],[1,"text-danger","text-center"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0),e._UZ(1,"ion-toolbar"),e.qZA(),e.TgZ(2,"ion-content",1)(3,"ion-refresher",2),e.NdJ("ionRefresh",function(c){return n.handle_refresh(c)}),e._UZ(4,"ion-refresher-content"),e.qZA(),e.YNc(5,U,4,0,"ng-container",3)(6,X,3,2,"ng-container",3),e.qZA(),e.YNc(7,q,3,3,"ng-template",null,4,e.W1O)),2&t&&(e.xp6(2),e.Q6J("fullscreen",!0),e.xp6(3),e.Q6J("ngIf",0===n.account_id.trim().length),e.xp6(1),e.Q6J("ngIf",0!==n.account_id.trim().length))},dependencies:[l.YG,l.PM,l.FN,l.W2,l.Gu,l.Q$,l.nJ,l.Wo,l.cJ,l.GO,l.sr,l.QI,u.sg,u.O5,u.tP,_.JJ,_.On,D,u.rS],styles:[".no-border[_ngcontent-%COMP%]{box-shadow:none!important}"]}),s})()}];let et=(()=>{var i;class s{}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[x.Bz.forChild(tt),x.Bz]}),s})(),nt=(()=>{var i;class s{}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[u.rS],imports:[l.Pc,u.ez,_.u5,L.e,et,N.forRoot({echarts:()=>o.e(8707).then(o.bind(o,18707))})]}),s})()}}]);